# NoteIM API æ¥å£æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-10-04 19:08  
**API åœ°å€**: https://api.noteim.com  
**æµ‹è¯•ç»“è®º**: âœ… **æ‰€æœ‰æ ¸å¿ƒæ¥å£æ»¡è¶³VSCodeæ’ä»¶é›†æˆéœ€æ±‚**

---

## ğŸ“Š æ¥å£æµ‹è¯•ç»“æœ

### 1. âœ… è®¾å¤‡æ³¨å†Œæ¥å£

**ç«¯ç‚¹**: `POST /v1/device/register`

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "device_id": "test-device-123",
  "device_name": "Test MacBook",
  "device_type": "vscode",
  "platform": "darwin"
}
```

**å“åº”ç¤ºä¾‹ (é¦–æ¬¡æ³¨å†Œ)**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "api_key": "fab34fe3d98b331bc4a0c5bceb706434350dedaf27fab843bddaf065f1b56ed0",
    "device_id": "test-device-123",
    "message": "Device registered successfully",
    "is_new_device": true
  }
}
```

**å“åº”ç¤ºä¾‹ (é‡å¤æ³¨å†Œ)**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "api_key": "fab34fe3d98b331bc4a0c5bceb706434350dedaf27fab843bddaf065f1b56ed0",
    "device_id": "test-device-123",
    "message": "Device already registered",
    "is_new_device": false
  }
}
```

**æµ‹è¯•ç»“æœ**:
- âœ… é¦–æ¬¡æ³¨å†ŒæˆåŠŸè¿”å›API Key
- âœ… é‡å¤æ³¨å†Œè¿”å›ç°æœ‰API Key
- âœ… `is_new_device` æ ‡å¿—æ­£ç¡®åŒºåˆ†æ–°æ—§è®¾å¤‡
- âœ… API Keyæ ¼å¼ä¸º64å­—ç¬¦SHA256å“ˆå¸Œ

---

### 2. âœ… æ–‡ä»¶ä¸Šä¼ æ¥å£

**ç«¯ç‚¹**: `POST /v1/files/upload`

**è®¤è¯**: `X-API-Key` Header

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**å‚æ•°**:
- `file` (å¿…éœ€): æ–‡ä»¶æ•°æ®
- `alt_text` (å¯é€‰): æ›¿ä»£æ–‡æœ¬
- `caption` (å¯é€‰): å›¾ç‰‡è¯´æ˜

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "url": "https://noteimg.com/md/1759601314602143164.txt",
    "uuid": "5e4d1c2b-22f7-42bf-9035-f4dcf401034f"
  }
}
```

**æµ‹è¯•ç»“æœ**:
- âœ… æ”¯æŒ X-API-Key è®¤è¯
- âœ… è¿”å›æ–‡ä»¶URLå’ŒUUID
- âœ… æ”¯æŒ multipart/form-data ä¸Šä¼ 
- âœ… æ”¯æŒ alt_text å’Œ caption å…ƒæ•°æ®

**é”™è¯¯å¤„ç†**:
- âœ… æ— API Key â†’ è¿”å› `401 Unauthorized`
- âœ… æ— æ•ˆAPI Key â†’ è¿”å› `{"error":"Invalid API key"}`

---

### 3. âœ… æ–‡ä»¶åˆ—è¡¨æ¥å£

**ç«¯ç‚¹**: `GET /v1/files`

**è®¤è¯**: `X-API-Key` Header

**æŸ¥è¯¢å‚æ•°**:
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `page_size` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤10

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "files": [
      {
        "id": 4,
        "uuid": "5e4d1c2b-22f7-42bf-9035-f4dcf401034f",
        "file_name": "test-image.txt",
        "file_url": "https://noteimg.com/md/1759601314602143164.txt",
        "file_size": 19,
        "mime_type": "text/plain",
        "alt_text": "test image",
        "caption": "Test upload from API",
        "ip": "2001:bb6:627:f000:d506:8ae1:d32a:6378",
        "city": "Hartstown",
        "country": "IE",
        "location": "53.3931,-6.4269",
        "created_at": "2025-10-05T02:08:36+08:00"
      }
    ],
    "total_count": 4,
    "page": 1,
    "page_size": 10
  }
}
```

**æµ‹è¯•ç»“æœ**:
- âœ… è¿”å›å½“å‰è®¾å¤‡çš„æ–‡ä»¶åˆ—è¡¨
- âœ… æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- âœ… åŒ…å«è¯¦ç»†çš„åœ°ç†ä½ç½®ä¿¡æ¯
- âœ… è¿”å›æ–‡ä»¶å…ƒæ•°æ®ï¼ˆå¤§å°ã€ç±»å‹ã€åˆ›å»ºæ—¶é—´ï¼‰

---

### 4. âœ… æ–‡ä»¶åˆ é™¤æ¥å£

**ç«¯ç‚¹**: `DELETE /v1/files/:id`

**è®¤è¯**: `X-API-Key` Header

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "message": "File deleted successfully"
  }
}
```

**æµ‹è¯•ç»“æœ**:
- âœ… åˆ é™¤åŠŸèƒ½æ­£å¸¸
- âš ï¸ ä½¿ç”¨æ•°å­—IDè€ŒéUUIDï¼ˆéœ€è¦æ³¨æ„ï¼‰

---

### 5. âœ… è®¾å¤‡ç»Ÿè®¡æ¥å£

**ç«¯ç‚¹**: `GET /v1/device/stats`

**è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆå…¬å¼€æ¥å£ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "total_devices": 3,
    "active_devices": 3,
    "total_uploads": 0
  }
}
```

**æµ‹è¯•ç»“æœ**:
- âœ… è¿”å›å…¨å±€ç»Ÿè®¡æ•°æ®
- âœ… æ— éœ€è®¤è¯å³å¯è®¿é—®

---

### 6. âœ… å¥åº·æ£€æŸ¥æ¥å£

**ç«¯ç‚¹**: `GET /health`

**å“åº”**: `{"status":"ok"}`

**æµ‹è¯•ç»“æœ**:
- âœ… æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥æ­£å¸¸

---

## ğŸ¯ VSCodeæ’ä»¶é›†æˆéœ€æ±‚å¯¹ç…§

| éœ€æ±‚ | APIæ”¯æŒ | çŠ¶æ€ |
|------|---------|------|
| è®¾å¤‡è‡ªåŠ¨æ³¨å†Œ | âœ… `/v1/device/register` | å®Œå…¨æ”¯æŒ |
| è·å–API Key | âœ… æ³¨å†Œæ—¶è¿”å› | å®Œå…¨æ”¯æŒ |
| API Keyè®¤è¯ | âœ… `X-API-Key` Header | å®Œå…¨æ”¯æŒ |
| æ–‡ä»¶ä¸Šä¼  | âœ… `/v1/files/upload` | å®Œå…¨æ”¯æŒ |
| è·å–æ–‡ä»¶URL | âœ… ä¸Šä¼ æ—¶è¿”å› | å®Œå…¨æ”¯æŒ |
| é‡å¤æ³¨å†Œå¤„ç† | âœ… è¿”å›ç°æœ‰Key | å®Œå…¨æ”¯æŒ |
| é”™è¯¯å¤„ç† | âœ… 401/é”™è¯¯æ¶ˆæ¯ | å®Œå…¨æ”¯æŒ |

---

## ğŸ¨ é¢å¤–å‘ç°çš„åŠŸèƒ½

### æ„å¤–æ”¶è·

1. **æ–‡ä»¶åˆ—è¡¨ç®¡ç†** - å¯ä»¥å®ç°ä¸Šä¼ å†å²è®°å½•åŠŸèƒ½
2. **æ–‡ä»¶åˆ é™¤** - å¯ä»¥å®ç°åˆ é™¤ä¸éœ€è¦çš„å›¾ç‰‡
3. **åœ°ç†ä½ç½®è·Ÿè¸ª** - è‡ªåŠ¨è®°å½•ä¸Šä¼ ä½ç½®ï¼ˆIP/åŸå¸‚/å›½å®¶ï¼‰
4. **åˆ†é¡µæŸ¥è¯¢** - æ”¯æŒå¤§é‡æ–‡ä»¶çš„é«˜æ•ˆæŸ¥è¯¢
5. **è®¾å¤‡ç»Ÿè®¡** - å¯ä»¥æ˜¾ç¤ºå…¨å±€ä½¿ç”¨æƒ…å†µ

### å¯ä»¥åœ¨æ’ä»¶ä¸­å®ç°çš„é«˜çº§åŠŸèƒ½

- ğŸ“ **ä¸Šä¼ å†å²é¢æ¿** - æ˜¾ç¤ºæ‰€æœ‰ä¸Šä¼ çš„æ–‡ä»¶
- ğŸ—‘ï¸ **æ–‡ä»¶ç®¡ç†** - åœ¨æ’ä»¶å†…åˆ é™¤ä¸éœ€è¦çš„å›¾ç‰‡
- ğŸ“Š **ä½¿ç”¨ç»Ÿè®¡** - æ˜¾ç¤ºä¸Šä¼ æ•°é‡ã€æ€»å¤§å°
- ğŸ” **æ–‡ä»¶æœç´¢** - æŒ‰æ–‡ä»¶åã€æ—¥æœŸæœç´¢
- ğŸ·ï¸ **æ ‡ç­¾ç®¡ç†** - ä½¿ç”¨alt_textå’Œcaption

---

## ğŸ“‹ APIç‰¹æ€§æ€»ç»“

### ä¼˜ç‚¹

âœ… **å®Œæ•´çš„RESTfulè®¾è®¡**  
âœ… **ç»Ÿä¸€çš„å“åº”æ ¼å¼** (`code`, `message`, `data`)  
âœ… **è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯**  
âœ… **æ”¯æŒå…ƒæ•°æ®** (alt_text, caption)  
âœ… **è‡ªåŠ¨IPåœ°ç†å®šä½**  
âœ… **åˆ†é¡µæŸ¥è¯¢æ”¯æŒ**  
âœ… **æ–‡ä»¶ç®¡ç†åŠŸèƒ½**  

### éœ€è¦æ³¨æ„

âš ï¸ **åˆ é™¤æ¥å£ä½¿ç”¨æ•°å­—ID** - éœ€è¦ä»æ–‡ä»¶åˆ—è¡¨è·å–ID  
âš ï¸ **API Keyå­˜å‚¨å®‰å…¨** - å»ºè®®ä½¿ç”¨VSCode Secrets API  
âš ï¸ **é€Ÿç‡é™åˆ¶** - éœ€è¦å®¢æˆ·ç«¯åšå¥½é”™è¯¯å¤„ç†  

---

## ğŸš€ VSCodeæ’ä»¶å¼€å‘å»ºè®®

### æ ¸å¿ƒåŠŸèƒ½ (MVP)

1. âœ… è®¾å¤‡è‡ªåŠ¨æ³¨å†Œ - APIå®Œå…¨æ”¯æŒ
2. âœ… å›¾ç‰‡ä¸Šä¼  - APIå®Œå…¨æ”¯æŒ
3. âœ… URLå¤åˆ¶åˆ°å‰ªè´´æ¿ - å®¢æˆ·ç«¯å®ç°
4. âœ… Markdownè‡ªåŠ¨æ’å…¥ - å®¢æˆ·ç«¯å®ç°

### é«˜çº§åŠŸèƒ½ (æ¨èå®ç°)

1. âœ… ä¸Šä¼ å†å²è®°å½• - ä½¿ç”¨ `/v1/files` æ¥å£
2. âœ… æ–‡ä»¶ç®¡ç† - ä½¿ç”¨ `DELETE /v1/files/:id`
3. âœ… æ‰¹é‡ä¸Šä¼  - å®¢æˆ·ç«¯å®ç°
4. âœ… å›¾ç‰‡é¢„è§ˆ - å®¢æˆ·ç«¯å®ç°

### æŠ€æœ¯å»ºè®®

1. **ä½¿ç”¨ `axios` æ›¿ä»£ `fetch`** - Node.jså…¼å®¹æ€§æ›´å¥½
2. **ä½¿ç”¨ VSCode Secrets API** - å®‰å…¨å­˜å‚¨API Key
3. **ä½¿ç”¨ `vscode.env.machineId`** - ç”Ÿæˆç¨³å®šçš„è®¾å¤‡ID
4. **å®ç°é‡è¯•æœºåˆ¶** - ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•
5. **æ·»åŠ è¿›åº¦æ¡** - ä¸Šä¼ å¤§æ–‡ä»¶æ—¶æ˜¾ç¤ºè¿›åº¦

---

## âœ… æœ€ç»ˆç»“è®º

**APIå®Œå…¨æ»¡è¶³VSCodeæ’ä»¶é›†æˆéœ€æ±‚ï¼**

- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„APIæ”¯æŒ
- APIè®¾è®¡è§„èŒƒï¼Œæ˜“äºé›†æˆ
- é¢å¤–æä¾›äº†æ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å®ç°æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒ
- å»ºè®®æŒ‰ç…§å‰é¢çš„æ–¹æ¡ˆæ–‡æ¡£å¼€å§‹å¼€å‘æ’ä»¶

**æ¨èå¼€å‘é¡ºåº**:
1. è®¾å¤‡æ³¨å†Œ + API Keyç®¡ç†
2. åŸºç¡€å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
3. Markdownè‡ªåŠ¨æ’å…¥
4. ä¸Šä¼ å†å²è®°å½•
5. æ–‡ä»¶ç®¡ç†åŠŸèƒ½

---

## ğŸ“ æµ‹è¯•å‘½ä»¤å‚è€ƒ

### æ³¨å†Œè®¾å¤‡
```bash
curl -X POST https://api.noteim.com/v1/device/register \
  -H "Content-Type: application/json" \
  -d '{"device_id":"test-123","device_name":"My Mac","device_type":"vscode","platform":"darwin"}'
```

### ä¸Šä¼ æ–‡ä»¶
```bash
curl -X POST https://api.noteim.com/v1/files/upload \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "file=@/path/to/image.png" \
  -F "alt_text=My Image" \
  -F "caption=Uploaded from VSCode"
```

### æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
```bash
curl https://api.noteim.com/v1/files \
  -H "X-API-Key: YOUR_API_KEY"
```

### åˆ é™¤æ–‡ä»¶
```bash
curl -X DELETE https://api.noteim.com/v1/files/123 \
  -H "X-API-Key: YOUR_API_KEY"
```
